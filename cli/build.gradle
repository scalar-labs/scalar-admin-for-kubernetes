plugins {
    id 'com.github.johnrengelman.shadow' version "${shadowJarPluginVersion}"
    id 'com.palantir.docker' version "${dockerPluginVersion}"
}

dependencies {
   implementation project(':lib')
   implementation "info.picocli:picocli:${picocliVersion}"
   implementation "com.fasterxml.jackson.core:jackson-databind:${jacksonVersion}"
}

shadowJar {
   archiveBaseName.set('scalar-admin-k8s-cli')
   archiveClassifier.set('')
   manifest {
        attributes 'Main-Class': 'com.scalar.admin.k8s.Cli'
   }

   // this is to merge gRPC service files into the shadow jar
   mergeServiceFiles()
}

docker {
    dependsOn shadowJar
    name "ghcr.io/scalar-labs/scalar-admin-k8s:${project.version}"
    files tasks.shadowJar.outputs
}
